{% extends 'field_agent/layouts/field_agent-base.html' %}
{% block title %}Milk Collection{% endblock %}
{% block content %}
<form id="milkForm" method="POST">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Submit</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const farmerIdInput = document.getElementById("id_farmer_id");
    const farmerNameInput = document.getElementById("id_farmer_name");
    const form = document.getElementById("milkForm");

    farmerIdInput.addEventListener("blur", function () {
        const farmerId = farmerIdInput.value.trim();
        if (farmerId) {
            fetch(`/get-farmer-name/?farmer_id=${farmerId}`)
                .then(res => res.json())
                .then(data => {
                    farmerNameInput.value = data.name || "";
                });
        }
    });

    form.addEventListener("submit", function () {
        setTimeout(() => {
            farmerIdInput.value = "";
            farmerNameInput.value = "";
            document.getElementById("id_quantity_liters").value = "";
        }, 100); 
    });
});
</script>

{% endblock %}
